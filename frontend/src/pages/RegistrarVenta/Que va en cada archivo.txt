1) utils/ventaUtils.js (helpers puros)

âœ… Todo lo que no depende de estados React:

getImgSrc() (con API_BASE_URL + FILES_BASE_URL)

limpiarCodigo() (trim + upper)

(opcional) calcularTotales(carrito) si luego quieres centralizar subtotal/impuesto/total

(opcional) armarPayloadVenta({ carrito, user, venta })

ğŸ“Œ Regla: si no usa useState/useEffect, va aquÃ­.

2) hooks/useVenta.js (toda la lÃ³gica y estados)

AquÃ­ se va casi todo lo que hoy hace tu pÃ¡gina excepto el JSX.

A) Estados que se mudan al hook

productos, carrito, buscar, inputBuscarRef

cajaLoading, cajaAbierta, cajaInfo, msgCaja

cai, modalSinCai, caiErrorMostradoRef

scanner bufferRef y scannerTimeout

toast

usarRTN, clientes, clientesLoading, filtroCliente

modalCliente, formularioCliente

modal (venta exitosa + dataRecibo)

feedbackModal

venta (mÃ©todo pago, efectivo, cambio, datos cliente)

refreshCaiTrigger, resetPagoTrigger

B) Funciones/acciones que se mudan al hook

mostrarToast

handleCambio

cargarProductos

consultarCajaEstado

consultarCai

agregarProductoAlCarrito

limpiarInputBuscar

handleBuscarCodigo

handleBuscarNombre

buscarYAgregar

quitarProducto

modificarCantidad

cargarClientes

handleGuardarCliente

handleCerrarModalCliente

registrarVenta

imprimirRecibo

C) useEffect/useMemo que se mudan al hook

useEffect de montaje (caja + cai + productos)

useEffect del scanner (keypress)

useEffect de cargar clientes al activar RTN

clientesFiltrados (useMemo)

total, impuesto, subtotal (useMemo)

ğŸ“Œ Salida del hook: devuelve un objeto con todo lo que la UI necesita (estados + handlers).

3) components/VentasHeader.jsx

Este archivo se encarga del encabezado y la parte superior:

âœ… Incluye:

El tÃ­tulo â€œMÃ³dulo de Ventasâ€

Switch â€œUsar cliente con RTNâ€

CardCaiDisponible al lado derecho

ğŸ“Œ Props tÃ­picas:

usarRTN, setUsarRTN

refreshCaiTrigger

4) components/ClientesSection.jsx

âœ… Incluye TODO el bloque:

TÃ­tulo â€œClientesâ€

Buscador por nombre/RTN

BotÃ³n â€œAgregar Clienteâ€

Tabla (scroll)

Inputs de nombre/RTN/direcciÃ³n que llenan venta

ğŸ“Œ Props tÃ­picas:

usarRTN

clientesLoading, clientesFiltrados

filtroCliente, setFiltroCliente

venta, setVenta

setModalCliente(true) (abrir modal)

5) components/BuscadorProducto.jsx

âœ… Incluye:

â€œBuscar Productoâ€

Form + InputGroup

datalist sugerencias

BotÃ³n Agregar + botÃ³n limpiar

Usa inputBuscarRef, buscar, setBuscar, buscarYAgregar, limpiarInputBuscar, productos

6) components/CarritoVenta.jsx

âœ… Incluye:

â€œCarrito de Ventaâ€

El contenedor con scroll y la tabla

Render de filas con imagen usando getImgSrc

Cantidad editable

BotÃ³n quitar

ğŸ“Œ Props tÃ­picas:

carrito

modificarCantidad, quitarProducto

getImgSrc (desde utils)

7) components/TotalesVenta.jsx

âœ… Incluye:

Columna izquierda: MetodosPagos

Columna derecha: subtotal / ISV / total

BotÃ³n â€œRegistrar Ventaâ€

ğŸ“Œ Props tÃ­picas:

total, subtotal, impuesto

handleCambio

resetPagoTrigger

registrarVenta

8) components/ModalesVenta.jsx

âœ… Mete aquÃ­ todos los modales:

Modal venta exitosa (imprimir/cerrar)

Modal agregar cliente

Modal sin CAI

Modal feedback (error/advertencia)

Toast (si quieres dejarlo aquÃ­ tambiÃ©n)

ğŸ“Œ Props tÃ­picas:

modal, setModal, imprimirRecibo

modalCliente, handleCerrarModalCliente, formularioCliente, setFormularioCliente, handleGuardarCliente

modalSinCai, setModalSinCai

feedbackModal, setFeedbackModal

toast

9) Â¿QuÃ© queda en RegistrarVentaPage.jsx?

Solo esto, bien corto:

âœ…

const { user } = useUser();

const pos = useVenta({ user, onChangePage });

Si pos.cajaLoading â†’ muestra loader (o un componente)

Si !pos.cajaAbierta â†’ muestra vista caja cerrada (puede ir dentro de VentasHeader o lo dejamos dentro del page)

Render normal usando componentes:

<VentasHeader />

<ClientesSection />

<BuscadorProducto />

<CarritoVenta />

<TotalesVenta />

<ModalesVenta />

ğŸ“Œ Importante: la â€œvista caja cerradaâ€ te sugiero dejarla en el Page por ahora (o crearla luego como extra), para no agregar otro archivo.

Orden de migraciÃ³n (para no perderte)

Crear carpetas + archivos vacÃ­os

Mover ventaUtils.js (getImgSrc + limpiarCodigo)

Crear useVenta.js y mover estados + lÃ³gica (sin JSX)

Partir UI en 5 componentes (Header, Clientes, Buscador, Carrito, Totales)

Mover modales a ModalesVenta.jsx

Dejar RegistrarVentaPage.jsx como orquestador